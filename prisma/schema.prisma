generator client {
  provider = "prisma-client-js"
  output   = "../generated/prisma/prisma/client"
}

datasource db {
  provider = "cockroachdb"
  url      = env("DATABASE_URL")
}

enum crdb_internal_region {
  gcp_europe_west3 @map("gcp-europe-west3")
}

enum STATUS {
  PENDING
  COMPLETED
  SENT
  PAID
  ACTIVE
  SUSPENDED
  DEACTIVATED
  APPROVED
}

enum ROLES {
  ADMIN
  COOP_MEMBER
  COOP_ADMIN
  USER
  SUPER_ADMIN
  SYSTEM
}

model Referral {
  id          String   @id @default(uuid())
  userId      String
  refreeEmail String
  status      STATUS
  bonusAmount Float
  archived    Boolean  @default(false)
  deleted     Boolean  @default(false)
  createdAt   DateTime @default(now()) @map("createIdx")
  updatedAt   DateTime @updatedAt @map("updateIdx")

  user User @relation(fields: [userId], references: [id])
}

model ProfitShare {
  id            String   @id @default(uuid())
  period        DateTime
  userId        String
  amount        Float
  comment       String?
  status        STATUS
  cooperativeId String
  archived      Boolean  @default(false)
  deleted       Boolean  @default(false)
  createdAt     DateTime @default(now()) @map("createIdx")
  updatedAt     DateTime @updatedAt @map("updateIdx")

  user        User        @relation(fields: [userId], references: [id])
  cooperative Cooperative @relation(fields: [cooperativeId], references: [id])
}

model UserGroup {
  id          String   @id @default(uuid())
  name        String
  description String?
  creator     String
  role        ROLES
  archived    Boolean  @default(false)
  deleted     Boolean  @default(false)
  createdAt   DateTime @default(now()) @map("createIdx")
  updatedAt   DateTime @updatedAt @map("updateIdx")

  user User @relation(fields: [creator], references: [id])
}

model User {
  id              String   @id @default(uuid())
  firstName       String
  lastName        String
  password        String
  address         Json
  email           String   @unique
  phone           String
  profileImg      String
  memberOf        Json
  status          STATUS
  verified        Boolean
  termAccepted    Boolean
  authenticatorId String
  bankInfo        Json
  archived        Boolean  @default(false)
  deleted         Boolean  @default(false)
  createdAt       DateTime @default(now()) @map("createIdx")
  updatedAt       DateTime @updatedAt @map("updateIdx")

  groups        UserGroup[]
  contributions Contribution[]
  loans         Loan[]
  payments      Payment[]
  repayments    Repayment[]
  Referral      Referral[]
  ProfitShare   ProfitShare[]
}

model Cooperative {
  id            String         @id @default(uuid())
  name          String
  contactPerson String
  status        STATUS
  verified      Boolean
  description   String?
  isPublic      Boolean        @map("inPublic")
  creator       String
  archived      Boolean        @default(false)
  deleted       Boolean        @default(false)
  createdAt     DateTime       @default(now()) @map("createIdx")
  updatedAt     DateTime       @updatedAt @map("updateIdx")
  ProfitShare   ProfitShare[]
  Contribution  Contribution[]
  Loan          Loan[]
}

model Contribution {
  id            String   @id @default(uuid())
  userId        String
  amount        Float
  isActive      Boolean
  cooperativeId String
  frequency     String
  status        STATUS
  paymentId     String?
  paymentMethod String?
  archived      Boolean  @default(false)
  deleted       Boolean  @default(false)
  createdAt     DateTime @default(now()) @map("createIdx")
  updatedAt     DateTime @updatedAt @map("updateIdx")

  user        User        @relation(fields: [userId], references: [id])
  cooperative Cooperative @relation(fields: [cooperativeId], references: [id])
}

model Loan {
  id              String   @id @default(uuid())
  beneficiaryId   String
  amount          Float
  comment         String?
  purpose         String?
  status          STATUS
  repaymentPeriod String?
  term            String?
  interestRate    Float?   @map("finetestRiske")
  guaranteed      Boolean?
  dueDate         DateTime @map("dinDate")
  payments        String
  paymentId       String?
  cooperativeId   String
  deleted         Boolean  @default(false)
  archived        Boolean  @default(false)
  createdAt       DateTime @default(now()) @map("createIdx")
  updatedAt       DateTime @updatedAt @map("updateIdx")

  beneficiary User        @relation(fields: [beneficiaryId], references: [id])
  cooperative Cooperative @relation(fields: [cooperativeId], references: [id])
  Repayment   Repayment[]
}

model Payment {
  id        String   @id @default(uuid())
  payeeId   String
  payerId   String
  amount    Float
  comment   String?
  status    STATUS
  deleted   Boolean  @default(false)
  archived  Boolean  @default(false)
  createdAt DateTime @default(now()) @map("createIdx")
  updatedAt DateTime @updatedAt @map("updateIdx")

  User   User?   @relation(fields: [userId], references: [id])
  userId String?
}

model Repayment {
  id        String   @id @default(uuid())
  payeeId   String
  payerId   String
  amount    Float
  dueDate   DateTime @map("dinDate")
  loanId    String?  @map("bankId")
  status    STATUS
  payments  String?
  deleted   Boolean  @default(false)
  archived  Boolean  @default(false)
  createdAt DateTime @default(now()) @map("createIdx")
  updatedAt DateTime @updatedAt @map("updateIdx")

  loan   Loan?   @relation(fields: [loanId], references: [id])
  User   User?   @relation(fields: [userId], references: [id])
  userId String?
}